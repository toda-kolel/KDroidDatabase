# ğŸ“„ Application Policy JSON Contribution Guide

ğŸ’¡ **We accept pull requests *only* containing JSON policy files.** No Kotlin or sourceâ€‘code changes should be included.

---

## ğŸ“‚ JSON Policy Schemas Overview

Below is the hierarchical representation of the three supported policy types:

```text
AppPolicy
â”œâ”€â”€ FixedPolicy
â”‚   â”œâ”€â”€ "type": "Fixed"
â”‚   â”œâ”€â”€ networkPolicy
â”‚   â”‚   â”œâ”€â”€ mode: FULL_OPEN | BLACKLIST | WHITELIST | LOCAL_ONLY
â”‚   â”‚   â””â”€â”€ spec: None | HostList{hostsâ€¦}
â”‚   â””â”€â”€ detectionRules [â€¦]
â”‚
â”œâ”€â”€ ModeBasedPolicy
â”‚   â”œâ”€â”€ "type": "ModeBased"
â”‚   â”œâ”€â”€ modePolicies
â”‚   â”‚   â”œâ”€â”€ OFFLINE â†’ NetworkPolicy{â€¦}
â”‚   â”‚   â”œâ”€â”€ GPS_ONLY â†’ NetworkPolicy{â€¦}
â”‚   â”‚   â”œâ”€â”€ GPS_AND_MAIL â†’ NetworkPolicy{â€¦}
â”‚   â”‚   â”œâ”€â”€ REDUCED_RISK â†’ NetworkPolicy{â€¦}
â”‚   â”‚   â””â”€â”€ MOST_OPEN â†’ NetworkPolicy{â€¦}
â”‚   â””â”€â”€ detectionRules [â€¦]
â”‚
â””â”€â”€ MultiModePolicy
    â”œâ”€â”€ "type": "MultiMode"
    â”œâ”€â”€ modeVariants
    â”‚   â”œâ”€â”€ userMode: GPS_ONLY
    â”‚   â”‚   â”œâ”€â”€ variants
    â”‚   â”‚   â”‚   â”œâ”€â”€ id: "strict",   policy: {mode: LOCAL_ONLY}
    â”‚   â”‚   â”‚   â””â”€â”€ id: "balanced", policy: {mode: WHITELIST, spec: HostList[â€¦]}
    â”‚   â”‚   â””â”€â”€ defaultVariantId: "balanced"
    â”‚   â””â”€â”€ userMode: MOST_OPEN
    â”‚       â”œâ”€â”€ variants
    â”‚       â”‚   â””â”€â”€ id: "open", policy: {mode: FULL_OPEN}
    â”‚       â””â”€â”€ defaultVariantId: "open"
    â””â”€â”€ detectionRules [â€¦]
```

---

## 1ï¸âƒ£ Templates for JSON Files

Choose the template that matches your use-case and copy it:

### ğŸ· FixedPolicy

```jsonc
{
  "type": "Fixed",                 // required
  "packageName": "org.signal",
  "category": "COMMUNICATION",
  "minimumVersionCode": 0,
  "networkPolicy": {
    "mode": "WHITELIST",
    "spec": {
      "type": "HostList",
      "hosts": ["signal.org"]
    }
  }
}
```

### ğŸ”„ ModeBasedPolicy

```jsonc
{
  "type": "ModeBased",
  "packageName": "com.whatsapp",
  "category": "COMMUNICATION",
  "minimumVersionCode": 0,
  "modePolicies": {
    "OFFLINE":  { "mode": "LOCAL_ONLY" },
    "GPS_ONLY": {
      "mode": "WHITELIST",
      "spec": { "type": "HostList", "hosts": ["whatsapp.com"] }
    },
    "MOST_OPEN": { "mode": "FULL_OPEN" }
  }
}
```

### ğŸ§© MultiModePolicy

```jsonc
{
  "type": "MultiMode",
  "packageName": "com.youtube.tv",
  "category": "VIDEO",
  "minimumVersionCode": 123,
  "modeVariants": [
    {
      "userMode": "GPS_ONLY",
      "variants": [
        {
          "id": "strict",
          "label": "Strict (local only)",
          "policy": { "mode": "LOCAL_ONLY" }
        },
        {
          "id": "balanced",
          "label": "Balanced (whitelist)",
          "policy": {
            "mode": "WHITELIST",
            "spec": { "type": "HostList", "hosts": ["googlevideo.com"] }
          }
        }
      ],
      "defaultVariantId": "balanced"
    },
    {
      "userMode": "MOST_OPEN",
      "variants": [
        {
          "id": "open",
          "label": "Fully open",
          "policy": { "mode": "FULL_OPEN" }
        }
      ]
    }
  ]
}
```

---

## 2ï¸âƒ£ Contribution Checklist

1. **Fork** the repository and create a new branch.
2. **Select** the appropriate template above.
3. **Edit** the placeholders with your real data.
4. **Validate** your JSON with a linter (e.g., [jsonlint.com](https://jsonlint.com/)).
5. **Place** the file under `app-policies/<category>/<packageName>.json`.
6. **Commit** *only* the JSON file and open a PR with a clear title & description.

ğŸš¦ CI will fail if the JSON is invalid or located in the wrong folder.

---

## 3ï¸âƒ£ Directory Layout

```text
app-policies/
  communication/
    org.signal.json
  video/
    com.youtube.tv.json
  â€¦
```

Each category has its own folder for easy navigation and to avoid merge conflicts.

---

## ğŸ’¬ Need Help?

Open an issue or mention **@your-team** in the PRâ€”responses within 24â€¯h. ğŸ™Œ
